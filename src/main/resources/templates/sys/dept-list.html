<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorator="layout">
<head>
<script th:src="@{/js/page.js}"></script>
</head>
<body>
	<!-- /section:basics/content.breadcrumbs -->
	<div class="page-content" layout:fragment="content" seq="13">
		<!-- /section:settings.box -->
		<div class="page-content-area visible widget-box" id="pageList">
			<div class="row">
				<div class="col-xs-12">
					<div class="row">
						<div class="col-xs-12">
							<form id="searchForm" action="#">
								<div class="table-header">部门列表</div>
								<div class="row">
									<div class="form-group col-sm-2">
										<input type="text" name="username" class="form-control"  placeholder="输入用户名"/>
									</div>
									<a class="btn btn-default" onclick="query()">查询</a>
									<a class="btn btn-success" href="#" data-target="#add">
									<i class="fa fa-plus"></i>&nbsp;新增</a> 
								</div>
							</form>
							<div class="table-responsive">
								<table id="sample-table-2"
									class="table table-striped table-bordered table-hover">
									<thead>
										<tr>
											<th class="center">序号<!-- <label class="position-relative">
													<input type="checkbox" class="ace" /> <span class="lbl"></span>
											</label> --></th>
											<th>部门名称</th>
											<th>上级ID</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody id="myData">
									</tbody>
								</table>
							</div>
							<div align="right">
								<ul id="myPage" class="pagination">
								</ul>
							</div>
						</div>
					</div>

					<!-- PAGE CONTENT ENDS -->
				</div>
				<!-- /.col -->
			</div>
			<!-- /.row -->
		</div>
		
		
		
		<div class="page-content-area" style="display:none" id="add">

						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<form class="form-horizontal" role="form" id="form1">
									<!-- #section:elements.form -->
									<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-1"> 部门名称：</label>

										<div class="col-sm-9">
											<input type="text" id="name" name="name"  placeholder="部门名称" class="col-xs-10 col-sm-5" />
										</div>
									</div>

									<div class="form-group">
										<label class="col-sm-3 control-label no-padding-right" for="form-field-tags">上级名称：</label>
										<div class="col-sm-2">
											<div class="pos-rel" onclick="queryDept()">
												<select class="form-control" id="dept" name="dept">
												 </select>
											</div>
										</div>
									</div>


									<div class="clearfix form-actions">
										<div class="col-md-offset-3 col-md-9">
											<button class="btn btn-info" type="button">
												<i class="ace-icon fa fa-check bigger-110"></i>
												立即提交
											</button>

											&nbsp; &nbsp; &nbsp;
											<button class="btn" type="reset" onclick="show()">
												<i class="ace-icon fa fa-undo bigger-110"></i>
												返回
											</button>
										</div>
									</div>
								</form>
							</div><!-- /.col -->
						</div><!-- /.row -->
		</div><!-- /.page-content-area -->
		<!-- /.page-content-area -->
		<!-- /.page-content-area -->
		<!-- /.page-content -->
		<script id="orderTemplate" type="text/x-handlebars-template">
	{{#each this}}
		<tr id="{{id}}">
		<td class="center">{{id}}</td>
        <td>{{name}}</td>
        <td>{{parentId}}</td>
        <td>查看</td>
		</tr>
	{{/each}}
	</script>
		<script type="text/javascript">
			function query(params) {
				$curs = params;
				window.location.hash = JSON.stringify($curs);
				$('#myPage').html('');
				$.ajax({
					type : "POST",
					url : '/dept/listData',
					data : params,
					dataType : 'json',
					success : function(data) {
						$('#myData').empty();
						var template = Handlebars.compile($("#orderTemplate")
								.html());
						var $tr = template(data.data.list);
						$('#myData').append($tr);
						pagePlugin('myPage', data.data.pages,
								data.data.pageNum, data.data.total, jumpPage);
					}
				});
			}
			
			//<![CDATA[	
			function queryDept() {
				$.ajax({
					type : "POST",
					url : '/dept/listData',
					data : {},
					dataType : 'json',
					success : function(data) {
						$("#dept").empty();
						if(data.rspCode=='0'){
							console.log(data.data.list);
							for(var i=0;i<data.data.list.length;i++){
								var m=data.data.list[i];
							   $("#dept").append("<option value="+m.id+">"+m.name+"</option>") ;
							}
						}
					}
				});
			}//]]>
		</script>
		<script type="text/javascript">
			jQuery(function($) {
			 $(document).on('click', 'a[data-target]', function(e) {
				var target = $(this).data('target');
				$('.widget-box.visible').css('display','none');
				$(target).css('display','block'); 
			 });
			});

			function show(){
				$("#pageList").css('display','block');
				$("#add").css('display','none');
			}
		</script>
		
	</div>
</body>
</html>